{"version":3,"names":["isString","useEverHadValue","useCallback","useState","computeOrigin","val","size","isStr","isPerc","endsWith","num","replace","perc","isNaN","useTransformOrigin","transformOrigin","transform","onLayoutProp","onLayout","needsLayoutX","needsLayoutY","x","y","undefined","everDidLayout","setSize","width","height","e","nativeEvent","layout","splice","translateY","translateX","push"],"sources":["useTransformOrigin.ts"],"sourcesContent":["/* eslint-disable react-hooks/rules-of-hooks */\nimport { isString } from '@legendapp/tools';\nimport { useEverHadValue } from '@legendapp/tools/react';\nimport { useCallback, useState } from 'react';\nimport type { LayoutChangeEvent } from 'react-native';\nimport type { TransformOrigin } from './Interfaces';\n\nfunction computeOrigin(val: TransformOrigin, size: number) {\n    const isStr = isString(val);\n    const isPerc = isStr && (val as string).endsWith('%');\n    // Chop off a % or px\n    let num = isStr ? +(val as string).replace(/%|px/, '') : val;\n    // Divide by 100 for percent or by view size if pixels\n    const perc = isPerc ? +num / 100 : +num / size;\n    // Offset by half of the size\n    if (!isNaN(perc)) {\n        num = (perc - 0.5) * size;\n    } else {\n        // Fallback to no origin\n        num = 0;\n    }\n\n    return num;\n}\n\nexport const useTransformOrigin = function useTransformOrigin(\n    transformOrigin: { x?: TransformOrigin; y?: TransformOrigin },\n    transform: any[],\n    onLayoutProp: (e: LayoutChangeEvent) => void\n) {\n    let onLayout = onLayoutProp;\n    let needsLayoutX = false;\n    let needsLayoutY = false;\n\n    // Compute whether x and y need layout based on input\n    if (transformOrigin) {\n        let { x, y } = transformOrigin;\n        needsLayoutX = x !== undefined && x !== '50%';\n        needsLayoutY = y !== undefined && y !== '50%';\n    }\n\n    // Compute whether we ever needed layout so we don't remove a hook if the origin is removed\n    const everDidLayout = useEverHadValue(!!transformOrigin, true);\n\n    if (everDidLayout) {\n        const [size, setSize] = useState<{ width: number; height: number }>({ width: 0, height: 0 });\n        onLayout = useCallback(\n            (e: LayoutChangeEvent) => {\n                setSize(e.nativeEvent.layout);\n                onLayoutProp?.(e);\n            },\n            [onLayoutProp]\n        );\n\n        if (transformOrigin && transform) {\n            let { x, y } = transformOrigin;\n\n            // Compute x and y origins\n            x = needsLayoutX ? computeOrigin(x, size.width) : 0;\n            y = needsLayoutY ? computeOrigin(y, size.height) : 0;\n\n            // First move the center of the view to the origin\n            transform.splice(0, 0, {\n                translateY: y,\n            });\n            transform.splice(0, 0, {\n                translateX: x,\n            });\n\n            // Restore it back the the original position after transforming\n            transform.push({\n                translateX: -x,\n            });\n            transform.push({\n                translateY: -y,\n            });\n        }\n    }\n\n    return onLayout;\n};\n"],"mappings":"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"}